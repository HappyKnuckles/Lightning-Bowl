<div class="grid-container">
  <ion-grid *ngFor="let i of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; let frameIndex = index">
    <ion-row>
      <ion-col class="middle frame">{{ i }}</ion-col>
    </ion-row>
    <ion-row>
      <ion-col class="input-col" *ngIf="i !== 10"></ion-col>
      <ion-col class="input-col" [class.current-throw]="frameIndex === currentFrameIndex() && currentThrowIndex() === 0">
        <ion-input type="text" clearOnEdit="true" inputmode="numeric" autocapitalize="on" readonly="true" [value]="getFrameValue(frameIndex, 0)">
        </ion-input>
      </ion-col>
      <ion-col class="input-col" *ngIf="i !== 10" [class.current-throw]="frameIndex === currentFrameIndex() && currentThrowIndex() === 1">
        <ion-input
          type="text"
          clearOnEdit="true"
          inputmode="numeric"
          autocapitalize="on"
          readonly="true"
          [disabled]="game().frames[frameIndex][0] === 10 && i !== 10"
          [value]="getFrameValue(frameIndex, 1)">
        </ion-input>
      </ion-col>
      <ion-col class="input-col" *ngIf="i === 10" [class.current-throw]="frameIndex === currentFrameIndex() && currentThrowIndex() === 1">
        <ion-input
          type="text"
          clearOnEdit="true"
          inputmode="numeric"
          autocapitalize="on"
          readonly="true"
          [disabled]="game().frames[frameIndex][0] === 10 && i !== 10"
          [value]="getFrameValue(frameIndex, 1)">
        </ion-input>
      </ion-col>
      <ion-col class="input-col" *ngIf="i === 10" [class.current-throw]="frameIndex === currentFrameIndex() && currentThrowIndex() === 2">
        <ion-input
          type="text"
          clearOnEdit="true"
          inputmode="numeric"
          autocapitalize="on"
          readonly="true"
          [value]="getFrameValue(frameIndex, 2)"
          [disabled]="game().frames[frameIndex][0] !== 10 && game().frames[frameIndex][0] + (game().frames[frameIndex][1] || 0) !== 10">
        </ion-input>
      </ion-col>
    </ion-row>

    <!-- Pin Deck Visualization Row -->
    <app-pin-deck-frame-row *ngIf="game().frames[frameIndex][0] !== undefined" [game]="game()" [frameIndex]="frameIndex"> </app-pin-deck-frame-row>

    <ion-row>
      <ion-col class="middle count">
        <ng-container
          *ngIf="
            (game().frames[frameIndex][0] !== undefined ||
              game().frames[frameIndex][1] !== undefined ||
              (i === 10 && game().frames[frameIndex][0] !== undefined && game().frames[frameIndex][1] !== undefined)) &&
            isNumber(game().frameScores[i - 1])
          ">
          {{ game().frameScores[i - 1] }}
        </ng-container>

        <ng-container *ngIf="i === 10 && (game().frames[frameIndex][0] === undefined || game().frames[frameIndex][1] === undefined)">
          <span style="color: var(--ion-color-secondary)"> ({{ maxScore() }}) </span>
        </ng-container>
      </ion-col>

      <ion-col
        *ngIf="
          !(
            (game().frames[frameIndex][0] !== undefined ||
              game().frames[frameIndex][1] !== undefined ||
              (i === 10 && game().frames[frameIndex][0] !== undefined)) &&
            isNumber(game().frameScores[i - 1])
          ) && !(i === 10 && game().frames[frameIndex][0] === undefined)
        "
        class="middle count"
        style="color: var(--ion-color-quartiary)"
        >0</ion-col
      >
    </ion-row>
  </ion-grid>
</div>

<div class="pin-input-container">
  <div class="pin-row">
    <ion-button
      class="pin"
      [class.active]="isPinSelected(7)"
      [class.disabled]="!isPinAvailable(7) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(7)"
      [disabled]="!isPinAvailable(7) || isGameComplete()"
      (click)="togglePin(7)">
      7
    </ion-button>
    <ion-button
      class="pin"
      [class.active]="isPinSelected(8)"
      [class.disabled]="!isPinAvailable(8) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(8)"
      [disabled]="!isPinAvailable(8) || isGameComplete()"
      (click)="togglePin(8)">
      8
    </ion-button>
    <ion-button
      class="pin"
      [class.active]="isPinSelected(9)"
      [class.disabled]="!isPinAvailable(9) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(9)"
      [disabled]="!isPinAvailable(9) || isGameComplete()"
      (click)="togglePin(9)">
      9
    </ion-button>
    <ion-button
      class="pin"
      [class.active]="isPinSelected(10)"
      [class.disabled]="!isPinAvailable(10) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(10)"
      [disabled]="!isPinAvailable(10) || isGameComplete()"
      (click)="togglePin(10)">
      10
    </ion-button>
  </div>
  <div class="pin-row">
    <ion-button
      class="pin"
      [class.active]="isPinSelected(4)"
      [class.disabled]="!isPinAvailable(4) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(4)"
      [disabled]="!isPinAvailable(4) || isGameComplete()"
      (click)="togglePin(4)">
      4
    </ion-button>
    <ion-button
      class="pin"
      [class.active]="isPinSelected(5)"
      [class.disabled]="!isPinAvailable(5) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(5)"
      [disabled]="!isPinAvailable(5) || isGameComplete()"
      (click)="togglePin(5)">
      5
    </ion-button>
    <ion-button
      class="pin"
      [class.active]="isPinSelected(6)"
      [class.disabled]="!isPinAvailable(6) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(6)"
      [disabled]="!isPinAvailable(6) || isGameComplete()"
      (click)="togglePin(6)">
      6
    </ion-button>
  </div>
  <div class="pin-row">
    <ion-button
      class="pin"
      [class.active]="isPinSelected(2)"
      [class.disabled]="!isPinAvailable(2) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(2)"
      [disabled]="!isPinAvailable(2) || isGameComplete()"
      (click)="togglePin(2)">
      2
    </ion-button>
    <ion-button
      class="pin"
      [class.active]="isPinSelected(3)"
      [class.disabled]="!isPinAvailable(3) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(3)"
      [disabled]="!isPinAvailable(3) || isGameComplete()"
      (click)="togglePin(3)">
      3
    </ion-button>
  </div>
  <div class="pin-row">
    <ion-button
      class="pin"
      [class.active]="isPinSelected(1)"
      [class.disabled]="!isPinAvailable(1) || isGameComplete()"
      [class.knocked-down]="isPinKnockedDownPreviously(1)"
      [disabled]="!isPinAvailable(1) || isGameComplete()"
      (click)="togglePin(1)">
      1
    </ion-button>
  </div>

  <div class="quick-actions">
    <ion-button size="small" (click)="recordStrike()" [disabled]="!canRecordStrike() || isGameComplete()"> X </ion-button>
    <ion-button size="small" (click)="recordSpare()" [disabled]="!canRecordSpare() || isGameComplete()"> / </ion-button>
    <ion-button size="small" (click)="undoLastThrow()" [disabled]="!canUndoLastThrow()">
      <ion-icon slot="icon-only" name="arrow-undo"></ion-icon>
    </ion-button>
    <ion-button size="small" (click)="confirmPinThrow()" [disabled]="isGameComplete()"> Confirm ({{ selectedPins.length }} pins) </ion-button>
  </div>
</div>
